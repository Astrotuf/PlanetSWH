import{s as Oe,g as X,e as x,t as w,i as ke,j as xe,k as ye,l as I,n as W,f as K,o as C}from"./hub.3096887d.js";import{s as Xt}from"./hub.3096887d.js";import{B as we,l,b as de,d as O,P as Ce,T as Pe,D as Y,e as z,a as Me,G as $e,x as ue,F as le,s as Le,U as He}from"./misc.54984152.js";function b(t,e){return t!=null?t:e()}function f(t){let e,n=t[0],i=1;for(;i<t.length;){const a=t[i],r=t[i+1];if(i+=2,(a==="optionalAccess"||a==="optionalCall")&&n==null)return;a==="access"||a==="optionalAccess"?(e=n,n=r(n)):(a==="call"||a==="optionalCall")&&(n=r((...s)=>n.call(e,...s)),e=void 0)}return n}function Fe(t,e={}){const n=t.method&&t.method.toUpperCase();let i="",a="url";e.customRoute||t.route?(i=e.customRoute||`${t.baseUrl||""}${t.route&&t.route.path}`,a="route"):(t.originalUrl||t.url)&&(i=Oe(t.originalUrl||t.url||""));let r="";return e.method&&n&&(r+=n),e.method&&e.path&&(r+=" "),e.path&&i&&(r+=i),[r,a]}const je=new RegExp("^[ \\t]*([0-9a-f]{32})?-?([0-9a-f]{16})?-?([01])?[ \\t]*$");function ze(t){const e=t.match(je);if(!t||!e)return;let n;return e[3]==="1"?n=!0:e[3]==="0"&&(n=!1),{traceId:e[1],parentSampled:n,parentSpanId:e[2]}}const ne="baggage",Re="sentry-",qe=/^sentry-/,We=8192;function Ve(t){if(!we(t)&&!Array.isArray(t))return;let e={};if(Array.isArray(t))e=t.reduce((i,a)=>{const r=pe(a);return{...i,...r}},{});else{if(!t)return;e=pe(t)}const n=Object.entries(e).reduce((i,[a,r])=>{if(a.match(qe)){const s=a.slice(Re.length);i[s]=r}return i},{});if(Object.keys(n).length>0)return n}function Ne(t){const e=Object.entries(t).reduce((n,[i,a])=>(a&&(n[`${Re}${i}`]=a),n),{});return Je(e)}function pe(t){return t.split(",").map(e=>e.split("=").map(n=>decodeURIComponent(n.trim()))).reduce((e,[n,i])=>(e[n]=i,e),{})}function Je(t){if(Object.keys(t).length!==0)return Object.entries(t).reduce((e,[n,i],a)=>{const r=`${encodeURIComponent(n)}=${encodeURIComponent(i)}`,s=a===0?r:`${e},${r}`;return s.length>We?((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.warn(`Not adding key: ${n} with val: ${i} to baggage header due to exceeding baggage size limits.`),e):s},"")}function ae(t){const e=X().getClient(),n=t||e&&e.getOptions();return!!n&&("tracesSampleRate"in n||"tracesSampler"in n)}function q(t){const n=(t||X()).getScope();return n&&n.getTransaction()}function E(t){return t/1e3}function Xe(){x("error",fe),x("unhandledrejection",fe)}function fe(){const t=q();if(t){const e="internal_error";(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log(`[Tracing] Transaction: ${e} -> Global error occured`),t.setStatus(e)}}class Q{__init(){this.spans=[]}constructor(e=1e3){Q.prototype.__init.call(this),this._maxlen=e}add(e){this.spans.length>this._maxlen?e.spanRecorder=void 0:this.spans.push(e)}}class R{__init2(){this.traceId=de()}__init3(){this.spanId=de().substring(16)}__init4(){this.startTimestamp=w()}__init5(){this.tags={}}__init6(){this.data={}}__init7(){this.instrumenter="sentry"}constructor(e){if(R.prototype.__init2.call(this),R.prototype.__init3.call(this),R.prototype.__init4.call(this),R.prototype.__init5.call(this),R.prototype.__init6.call(this),R.prototype.__init7.call(this),!e)return this;e.traceId&&(this.traceId=e.traceId),e.spanId&&(this.spanId=e.spanId),e.parentSpanId&&(this.parentSpanId=e.parentSpanId),"sampled"in e&&(this.sampled=e.sampled),e.op&&(this.op=e.op),e.description&&(this.description=e.description),e.data&&(this.data=e.data),e.tags&&(this.tags=e.tags),e.status&&(this.status=e.status),e.startTimestamp&&(this.startTimestamp=e.startTimestamp),e.endTimestamp&&(this.endTimestamp=e.endTimestamp),e.instrumenter&&(this.instrumenter=e.instrumenter)}startChild(e){const n=new R({...e,parentSpanId:this.spanId,sampled:this.sampled,traceId:this.traceId});if(n.spanRecorder=this.spanRecorder,n.spanRecorder&&n.spanRecorder.add(n),n.transaction=this.transaction,(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&n.transaction){const i=e&&e.op||"< unknown op >",a=n.transaction.name||"< unknown name >",r=n.transaction.spanId,s=`[Tracing] Starting '${i}' span on transaction '${a}' (${r}).`;n.transaction.metadata.spanMetadata[n.spanId]={logMessage:s},l.log(s)}return n}setTag(e,n){return this.tags={...this.tags,[e]:n},this}setData(e,n){return this.data={...this.data,[e]:n},this}setStatus(e){return this.status=e,this}setHttpStatus(e){this.setTag("http.status_code",String(e));const n=Ke(e);return n!=="unknown_error"&&this.setStatus(n),this}isSuccess(){return this.status==="ok"}finish(e){if((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&this.transaction&&this.transaction.spanId!==this.spanId){const{logMessage:n}=this.transaction.metadata.spanMetadata[this.spanId];n&&l.log(n.replace("Starting","Finishing"))}this.endTimestamp=typeof e=="number"?e:w()}toTraceparent(){let e="";return this.sampled!==void 0&&(e=this.sampled?"-1":"-0"),`${this.traceId}-${this.spanId}${e}`}toContext(){return O({data:this.data,description:this.description,endTimestamp:this.endTimestamp,op:this.op,parentSpanId:this.parentSpanId,sampled:this.sampled,spanId:this.spanId,startTimestamp:this.startTimestamp,status:this.status,tags:this.tags,traceId:this.traceId})}updateWithContext(e){return this.data=b(e.data,()=>({})),this.description=e.description,this.endTimestamp=e.endTimestamp,this.op=e.op,this.parentSpanId=e.parentSpanId,this.sampled=e.sampled,this.spanId=b(e.spanId,()=>this.spanId),this.startTimestamp=b(e.startTimestamp,()=>this.startTimestamp),this.status=e.status,this.tags=b(e.tags,()=>({})),this.traceId=b(e.traceId,()=>this.traceId),this}getTraceContext(){return O({data:Object.keys(this.data).length>0?this.data:void 0,description:this.description,op:this.op,parent_span_id:this.parentSpanId,span_id:this.spanId,status:this.status,tags:Object.keys(this.tags).length>0?this.tags:void 0,trace_id:this.traceId})}toJSON(){return O({data:Object.keys(this.data).length>0?this.data:void 0,description:this.description,op:this.op,parent_span_id:this.parentSpanId,span_id:this.spanId,start_timestamp:this.startTimestamp,status:this.status,tags:Object.keys(this.tags).length>0?this.tags:void 0,timestamp:this.endTimestamp,trace_id:this.traceId})}}function Ke(t){if(t<400&&t>=100)return"ok";if(t>=400&&t<500)switch(t){case 401:return"unauthenticated";case 403:return"permission_denied";case 404:return"not_found";case 409:return"already_exists";case 413:return"failed_precondition";case 429:return"resource_exhausted";default:return"invalid_argument"}if(t>=500&&t<600)switch(t){case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline_exceeded";default:return"internal_error"}return"unknown_error"}class G extends R{__init(){this._measurements={}}__init2(){this._contexts={}}__init3(){this._frozenDynamicSamplingContext=void 0}constructor(e,n){super(e),G.prototype.__init.call(this),G.prototype.__init2.call(this),G.prototype.__init3.call(this),this._hub=n||X(),this._name=e.name||"",this.metadata={source:"custom",...e.metadata,spanMetadata:{},changes:[],propagations:0},this._trimEnd=e.trimEnd,this.transaction=this;const i=this.metadata.dynamicSamplingContext;i&&(this._frozenDynamicSamplingContext={...i})}get name(){return this._name}set name(e){this.setName(e)}setName(e,n="custom"){(e!==this.name||n!==this.metadata.source)&&this.metadata.changes.push({source:this.metadata.source,timestamp:ke(),propagations:this.metadata.propagations}),this._name=e,this.metadata.source=n}initSpanRecorder(e=1e3){this.spanRecorder||(this.spanRecorder=new Q(e)),this.spanRecorder.add(this)}setContext(e,n){n===null?delete this._contexts[e]:this._contexts[e]=n}setMeasurement(e,n,i=""){this._measurements[e]={value:n,unit:i}}setMetadata(e){this.metadata={...this.metadata,...e}}finish(e){if(this.endTimestamp!==void 0)return;if(this.name||((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.warn("Transaction has no name, falling back to `<unlabeled transaction>`."),this.name="<unlabeled transaction>"),super.finish(e),this.sampled!==!0){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log("[Tracing] Discarding transaction because its trace was not chosen to be sampled.");const s=this._hub.getClient();s&&s.recordDroppedEvent("sample_rate","transaction");return}const n=this.spanRecorder?this.spanRecorder.spans.filter(s=>s!==this&&s.endTimestamp):[];this._trimEnd&&n.length>0&&(this.endTimestamp=n.reduce((s,o)=>s.endTimestamp&&o.endTimestamp?s.endTimestamp>o.endTimestamp?s:o:s).endTimestamp);const i=this.metadata,a={contexts:{...this._contexts,trace:this.getTraceContext()},spans:n,start_timestamp:this.startTimestamp,tags:this.tags,timestamp:this.endTimestamp,transaction:this.name,type:"transaction",sdkProcessingMetadata:{...i,dynamicSamplingContext:this.getDynamicSamplingContext()},...i.source&&{transaction_info:{source:i.source,changes:i.changes,propagations:i.propagations}}};return Object.keys(this._measurements).length>0&&((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log("[Measurements] Adding measurements to transaction",JSON.stringify(this._measurements,void 0,2)),a.measurements=this._measurements),(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log(`[Tracing] Finishing ${this.op} transaction: ${this.name}.`),this._hub.captureEvent(a)}toContext(){const e=super.toContext();return O({...e,name:this.name,trimEnd:this._trimEnd})}updateWithContext(e){return super.updateWithContext(e),this.name=b(e.name,()=>""),this._trimEnd=e.trimEnd,this}getDynamicSamplingContext(){if(this._frozenDynamicSamplingContext)return this._frozenDynamicSamplingContext;const e=this._hub||X(),n=e&&e.getClient();if(!n)return{};const{environment:i,release:a}=n.getOptions()||{},{publicKey:r}=n.getDsn()||{},s=this.metadata.sampleRate,o=s!==void 0?s.toString():void 0,c=e.getScope(),{segment:_}=c&&c.getUser()||{},u=this.metadata.source,d=u&&u!=="url"?this.name:void 0;return O({environment:i,release:a,transaction:d,user_segment:_,public_key:r,trace_id:this.traceId,sample_rate:o})}}const be=1e3,De=3e4,Be=5e3;class Qe extends Q{constructor(e,n,i,a){super(a),this._pushActivity=e,this._popActivity=n,this.transactionSpanId=i}add(e){e.spanId!==this.transactionSpanId&&(e.finish=n=>{e.endTimestamp=typeof n=="number"?n:w(),this._popActivity(e.spanId)},e.endTimestamp===void 0&&this._pushActivity(e.spanId)),super.add(e)}}class A extends G{__init(){this.activities={}}__init2(){this._heartbeatCounter=0}__init3(){this._finished=!1}__init4(){this._beforeFinishCallbacks=[]}constructor(e,n,i=be,a=De,r=Be,s=!1){super(e,n),this._idleHub=n,this._idleTimeout=i,this._finalTimeout=a,this._heartbeatInterval=r,this._onScope=s,A.prototype.__init.call(this),A.prototype.__init2.call(this),A.prototype.__init3.call(this),A.prototype.__init4.call(this),s&&(he(n),(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log(`Setting idle transaction on scope. Span ID: ${this.spanId}`),n.configureScope(o=>o.setSpan(this))),this._startIdleTimeout(),setTimeout(()=>{this._finished||(this.setStatus("deadline_exceeded"),this.finish())},this._finalTimeout)}finish(e=w()){if(this._finished=!0,this.activities={},this.spanRecorder){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log("[Tracing] finishing IdleTransaction",new Date(e*1e3).toISOString(),this.op);for(const n of this._beforeFinishCallbacks)n(this,e);this.spanRecorder.spans=this.spanRecorder.spans.filter(n=>{if(n.spanId===this.spanId)return!0;n.endTimestamp||(n.endTimestamp=e,n.setStatus("cancelled"),(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log("[Tracing] cancelling span since transaction ended early",JSON.stringify(n,void 0,2)));const i=n.startTimestamp<e;return i||(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log("[Tracing] discarding Span since it happened after Transaction was finished",JSON.stringify(n,void 0,2)),i}),(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log("[Tracing] flushing IdleTransaction")}else(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log("[Tracing] No active IdleTransaction");return this._onScope&&he(this._idleHub),super.finish(e)}registerBeforeFinishCallback(e){this._beforeFinishCallbacks.push(e)}initSpanRecorder(e){if(!this.spanRecorder){const n=a=>{this._finished||this._pushActivity(a)},i=a=>{this._finished||this._popActivity(a)};this.spanRecorder=new Qe(n,i,this.spanId,e),(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log("Starting heartbeat"),this._pingHeartbeat()}this.spanRecorder.add(this)}_cancelIdleTimeout(){this._idleTimeoutID&&(clearTimeout(this._idleTimeoutID),this._idleTimeoutID=void 0)}_startIdleTimeout(e){this._cancelIdleTimeout(),this._idleTimeoutID=setTimeout(()=>{!this._finished&&Object.keys(this.activities).length===0&&this.finish(e)},this._idleTimeout)}_pushActivity(e){this._cancelIdleTimeout(),(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log(`[Tracing] pushActivity: ${e}`),this.activities[e]=!0,(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log("[Tracing] new activities count",Object.keys(this.activities).length)}_popActivity(e){if(this.activities[e]&&((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log(`[Tracing] popActivity ${e}`),delete this.activities[e],(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log("[Tracing] new activities count",Object.keys(this.activities).length)),Object.keys(this.activities).length===0){const n=w()+this._idleTimeout/1e3;this._startIdleTimeout(n)}}_beat(){if(this._finished)return;const e=Object.keys(this.activities).join("");e===this._prevHeartbeatString?this._heartbeatCounter+=1:this._heartbeatCounter=1,this._prevHeartbeatString=e,this._heartbeatCounter>=3?((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log("[Tracing] Transaction finished because of no change for 3 heart beats"),this.setStatus("deadline_exceeded"),this.finish()):this._pingHeartbeat()}_pingHeartbeat(){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log(`pinging Heartbeat -> current counter: ${this._heartbeatCounter}`),setTimeout(()=>{this._beat()},this._heartbeatInterval)}}function he(t){const e=t.getScope();e&&e.getTransaction()&&e.setSpan(void 0)}function Ze(){const t=this.getScope();if(t){const e=t.getSpan();if(e)return{"sentry-trace":e.toTraceparent()}}return{}}function Ue(t,e,n){if(!ae(e))return t.sampled=!1,t;if(t.sampled!==void 0)return t.setMetadata({sampleRate:Number(t.sampled)}),t;let i;return typeof e.tracesSampler=="function"?(i=e.tracesSampler(n),t.setMetadata({sampleRate:Number(i)})):n.parentSampled!==void 0?i=n.parentSampled:(i=e.tracesSampleRate,t.setMetadata({sampleRate:Number(i)})),et(i)?i?(t.sampled=Math.random()<i,t.sampled?((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log(`[Tracing] starting ${t.op} transaction - ${t.name}`),t):((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log(`[Tracing] Discarding transaction because it's not included in the random sample (sampling rate = ${Number(i)})`),t)):((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log(`[Tracing] Discarding transaction because ${typeof e.tracesSampler=="function"?"tracesSampler returned 0 or false":"a negative sampling decision was inherited or tracesSampleRate is set to 0"}`),t.sampled=!1,t):((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.warn("[Tracing] Discarding transaction because of invalid sample rate."),t.sampled=!1,t)}function et(t){return Ce(t)||!(typeof t=="number"||typeof t=="boolean")?((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.warn(`[Tracing] Given sample rate is invalid. Sample rate must be a boolean or a number between 0 and 1. Got ${JSON.stringify(t)} of type ${JSON.stringify(typeof t)}.`),!1):t<0||t>1?((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.warn(`[Tracing] Given sample rate is invalid. Sample rate must be between 0 and 1. Got ${t}.`),!1):!0}function tt(t,e){const n=this.getClient(),i=n&&n.getOptions()||{},a=i.instrumenter||"sentry",r=t.instrumenter||"sentry";a!==r&&((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.error(`A transaction was started with instrumenter=\`${r}\`, but the SDK is configured with the \`${a}\` instrumenter.
The transaction will not be sampled. Please use the ${a} instrumentation to start transactions.`),t.sampled=!1);let s=new G(t,this);return s=Ue(s,i,{parentSampled:t.parentSampled,transactionContext:t,...e}),s.sampled&&s.initSpanRecorder(i._experiments&&i._experiments.maxSpans),s}function nt(t,e,n,i,a,r,s){const o=t.getClient(),c=o&&o.getOptions()||{};let _=new A(e,t,n,i,s,a);return _=Ue(_,c,{parentSampled:e.parentSampled,transactionContext:e,...r}),_.sampled&&_.initSpanRecorder(c._experiments&&c._experiments.maxSpans),_}function it(){const t=ye();!t.__SENTRY__||(t.__SENTRY__.extensions=t.__SENTRY__.extensions||{},t.__SENTRY__.extensions.startTransaction||(t.__SENTRY__.extensions.startTransaction=tt),t.__SENTRY__.extensions.traceHeaders||(t.__SENTRY__.extensions.traceHeaders=Ze))}function st(){const t=ye();if(!t.__SENTRY__)return;const e={mongodb(){const i=W(module,"./integrations/node/mongo");return new i.Mongo},mongoose(){const i=W(module,"./integrations/node/mongo");return new i.Mongo({mongoose:!0})},mysql(){const i=W(module,"./integrations/node/mysql");return new i.Mysql},pg(){const i=W(module,"./integrations/node/postgres");return new i.Postgres}},n=Object.keys(e).filter(i=>!!I(i)).map(i=>{try{return e[i]()}catch{return}}).filter(i=>i);n.length>0&&(t.__SENTRY__.integrations=[...t.__SENTRY__.integrations||[],...n])}function at(){it(),xe()&&st(),Xe()}function D(t){const e=f([t,"call",i=>i(),"access",i=>i.getClient,"call",i=>i(),"optionalAccess",i=>i.getOptions,"call",i=>i()]);return(f([e,"optionalAccess",i=>i.instrumenter])||"sentry")!=="sentry"}class P{static __initStatic(){this.id="Express"}__init(){this.name=P.id}constructor(e={}){P.prototype.__init.call(this),this._router=e.router||e.app,this._methods=(Array.isArray(e.methods)?e.methods:[]).concat("use")}setupOnce(e,n){if(!this._router){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.error("ExpressIntegration is missing an Express instance");return}if(D(n)){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log("Express Integration is skipped because of instrumenter configuration.");return}ct(this._router,this._methods),_t(this._router)}}P.__initStatic();function me(t,e){const n=t.length;switch(n){case 2:return function(i,a){const r=a.__sentry_transaction;if(r){const s=r.startChild({description:t.name,op:`middleware.express.${e}`});a.once("finish",()=>{s.finish()})}return t.call(this,i,a)};case 3:return function(i,a,r){const s=a.__sentry_transaction,o=f([s,"optionalAccess",c=>c.startChild,"call",c=>c({description:t.name,op:`middleware.express.${e}`})]);t.call(this,i,a,function(...c){f([o,"optionalAccess",_=>_.finish,"call",_=>_()]),r.call(this,...c)})};case 4:return function(i,a,r,s){const o=r.__sentry_transaction,c=f([o,"optionalAccess",_=>_.startChild,"call",_=>_({description:t.name,op:`middleware.express.${e}`})]);t.call(this,i,a,r,function(..._){f([c,"optionalAccess",u=>u.finish,"call",u=>u()]),s.call(this,..._)})};default:throw new Error(`Express middleware takes 2-4 arguments. Got: ${n}`)}}function rt(t,e){return t.map(n=>typeof n=="function"?me(n,e):Array.isArray(n)?n.map(i=>typeof i=="function"?me(i,e):i):n)}function ot(t,e){const n=t[e];return t[e]=function(...i){return n.call(this,...rt(i,e))},t}function ct(t,e=[]){e.forEach(n=>ot(t,n))}function _t(t){const e="settings"in t;e&&t._router===void 0&&t.lazyrouter&&t.lazyrouter();const n=e?t._router:t;if(!n){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.debug("Cannot instrument router for URL Parameterization (did not find a valid router)."),(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.debug("Routing instrumentation is currently only supported in Express 4.");return}const i=Object.getPrototypeOf(n),a=i.process_params;i.process_params=function(s,o,c,_,u){c._reconstructedRoute||(c._reconstructedRoute="");const{layerRoutePath:d,isRegex:h,isArray:p,numExtraSegments:g}=dt(s);(d||h||p)&&(c._hasParameters=!0);const N=(d||s.path||"").split("/").filter(U=>U.length>0&&(h||p||!U.includes("*"))).join("/");N&&N.length>0&&(c._reconstructedRoute+=`/${N}${h?"/":""}`);const B=K(c.originalUrl||"")+g,Ie=K(c._reconstructedRoute);if(B===Ie){c._hasParameters||c._reconstructedRoute!==c.originalUrl&&(c._reconstructedRoute=c.originalUrl);const U=_.__sentry_transaction;if(U&&U.metadata.source!=="custom"){const Ye=c._reconstructedRoute||"/";U.setName(...Fe(c,{path:!0,method:!0,customRoute:Ye}))}}return a.call(this,s,o,c,_,u)}}function dt(t){const e=f([t,"access",s=>s.route,"optionalAccess",s=>s.path]),n=Pe(e),i=Array.isArray(e);if(!e)return{isRegex:n,isArray:i,numExtraSegments:0};const a=i?Math.max(ut(e)-K(t.path||""),0):0;return{layerRoutePath:lt(i,e),isRegex:n,isArray:i,numExtraSegments:a}}function ut(t){return t.reduce((e,n)=>e+K(n.toString()),0)}function lt(t,e){return t?e.map(n=>n.toString()).join(","):e&&e.toString()}class M{static __initStatic(){this.id="Postgres"}__init(){this.name=M.id}constructor(e={}){M.prototype.__init.call(this),this._usePgNative=!!e.usePgNative}setupOnce(e,n){const i=I("pg");if(!i){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.error("Postgres Integration was unable to require `pg` package.");return}if(D(n)){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log("Postgres Integration is skipped because of instrumenter configuration.");return}if(this._usePgNative&&!f([i,"access",r=>r.native,"optionalAccess",r=>r.Client])){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.error("Postgres Integration was unable to access 'pg-native' bindings.");return}const{Client:a}=this._usePgNative?i.native:i;Y(a.prototype,"query",function(r){return function(s,o,c){const _=n().getScope(),u=f([_,"optionalAccess",p=>p.getSpan,"call",p=>p()]),d=f([u,"optionalAccess",p=>p.startChild,"call",p=>p({description:typeof s=="string"?s:s.text,op:"db"})]);if(typeof c=="function")return r.call(this,s,o,function(p,g){f([d,"optionalAccess",S=>S.finish,"call",S=>S()]),c(p,g)});if(typeof o=="function")return r.call(this,s,function(p,g){f([d,"optionalAccess",S=>S.finish,"call",S=>S()]),o(p,g)});const h=typeof o<"u"?r.call(this,s,o):r.call(this,s);return z(h)?h.then(p=>(f([d,"optionalAccess",g=>g.finish,"call",g=>g()]),p)):(f([d,"optionalAccess",p=>p.finish,"call",p=>p()]),h)}})}}M.__initStatic();class ${constructor(){$.prototype.__init.call(this)}static __initStatic(){this.id="Mysql"}__init(){this.name=$.id}setupOnce(e,n){const i=I("mysql/lib/Connection.js");if(!i){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.error("Mysql Integration was unable to require `mysql` package.");return}if(D(n)){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log("Mysql Integration is skipped because of instrumenter configuration.");return}Y(i,"createQuery",function(a){return function(r,s,o){const c=n().getScope(),_=f([c,"optionalAccess",d=>d.getSpan,"call",d=>d()]),u=f([_,"optionalAccess",d=>d.startChild,"call",d=>d({description:typeof r=="string"?r:r.sql,op:"db"})]);return typeof o=="function"?a.call(this,r,s,function(d,h,p){f([u,"optionalAccess",g=>g.finish,"call",g=>g()]),o(d,h,p)}):typeof s=="function"?a.call(this,r,function(d,h,p){f([u,"optionalAccess",g=>g.finish,"call",g=>g()]),s(d,h,p)}):a.call(this,r,s,o)}})}}$.__initStatic();const pt=["aggregate","bulkWrite","countDocuments","createIndex","createIndexes","deleteMany","deleteOne","distinct","drop","dropIndex","dropIndexes","estimatedDocumentCount","find","findOne","findOneAndDelete","findOneAndReplace","findOneAndUpdate","indexes","indexExists","indexInformation","initializeOrderedBulkOp","insertMany","insertOne","isCapped","mapReduce","options","parallelCollectionScan","rename","replaceOne","stats","updateMany","updateOne"],ft={bulkWrite:["operations"],countDocuments:["query"],createIndex:["fieldOrSpec"],createIndexes:["indexSpecs"],deleteMany:["filter"],deleteOne:["filter"],distinct:["key","query"],dropIndex:["indexName"],find:["query"],findOne:["query"],findOneAndDelete:["filter"],findOneAndReplace:["filter","replacement"],findOneAndUpdate:["filter","update"],indexExists:["indexes"],insertMany:["docs"],insertOne:["doc"],mapReduce:["map","reduce"],rename:["newName"],replaceOne:["filter","doc"],updateMany:["filter","update"],updateOne:["filter","update"]};class L{static __initStatic(){this.id="Mongo"}__init(){this.name=L.id}constructor(e={}){L.prototype.__init.call(this),this._operations=Array.isArray(e.operations)?e.operations:pt,this._describeOperations="describeOperations"in e?e.describeOperations:!0,this._useMongoose=!!e.useMongoose}setupOnce(e,n){const i=this._useMongoose?"mongoose":"mongodb",a=I(i);if(!a){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.error(`Mongo Integration was unable to require \`${i}\` package.`);return}if(D(n)){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log("Mongo Integration is skipped because of instrumenter configuration.");return}this._instrumentOperations(a.Collection,this._operations,n)}_instrumentOperations(e,n,i){n.forEach(a=>this._patchOperation(e,a,i))}_patchOperation(e,n,i){if(!(n in e.prototype))return;const a=this._getSpanContextFromOperationArguments.bind(this);Y(e.prototype,n,function(r){return function(...s){const o=s[s.length-1],c=i().getScope(),_=f([c,"optionalAccess",d=>d.getSpan,"call",d=>d()]);if(typeof o!="function"||n==="mapReduce"&&s.length===2){const d=f([_,"optionalAccess",p=>p.startChild,"call",p=>p(a(this,n,s))]),h=r.call(this,...s);return z(h)?h.then(p=>(f([d,"optionalAccess",g=>g.finish,"call",g=>g()]),p)):(f([d,"optionalAccess",p=>p.finish,"call",p=>p()]),h)}const u=f([_,"optionalAccess",d=>d.startChild,"call",d=>d(a(this,n,s.slice(0,-1)))]);return r.call(this,...s.slice(0,-1),function(d,h){f([u,"optionalAccess",p=>p.finish,"call",p=>p()]),o(d,h)})}})}_getSpanContextFromOperationArguments(e,n,i){const a={collectionName:e.collectionName,dbName:e.dbName,namespace:e.namespace},r={op:"db",description:n,data:a},s=ft[n],o=Array.isArray(this._describeOperations)?this._describeOperations.includes(n):this._describeOperations;if(!s||!o)return r;try{if(n==="mapReduce"){const[c,_]=i;a[s[0]]=typeof c=="string"?c:c.name||"<anonymous>",a[s[1]]=typeof _=="string"?_:_.name||"<anonymous>"}else for(let c=0;c<s.length;c++)a[s[c]]=JSON.stringify(i[c])}catch{}return r}}L.__initStatic();function ht(t){return t&&!!t.$use}class H{static __initStatic(){this.id="Prisma"}__init(){this.name=H.id}constructor(e={}){H.prototype.__init.call(this),ht(e.client)?this._client=e.client:(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.warn(`Unsupported Prisma client provided to PrismaIntegration. Provided client: ${JSON.stringify(e.client)}`)}setupOnce(e,n){if(!this._client){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.error("PrismaIntegration is missing a Prisma Client Instance");return}if(D(n)){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log("Prisma Integration is skipped because of instrumenter configuration.");return}this._client.$use((i,a)=>{const r=n().getScope(),s=f([r,"optionalAccess",d=>d.getSpan,"call",d=>d()]),o=i.action,c=i.model,_=f([s,"optionalAccess",d=>d.startChild,"call",d=>d({description:c?`${c} ${o}`:o,op:"db.sql.prisma"})]),u=a(i);return z(u)?u.then(d=>(f([_,"optionalAccess",h=>h.finish,"call",h=>h()]),d)):(f([_,"optionalAccess",d=>d.finish,"call",d=>d()]),u)})}}H.__initStatic();class F{constructor(){F.prototype.__init.call(this)}static __initStatic(){this.id="GraphQL"}__init(){this.name=F.id}setupOnce(e,n){const i=I("graphql/execution/execute.js");if(!i){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.error("GraphQL Integration was unable to require graphql/execution package.");return}if(D(n)){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log("GraphQL Integration is skipped because of instrumenter configuration.");return}Y(i,"execute",function(a){return function(...r){const s=n().getScope(),o=f([s,"optionalAccess",u=>u.getSpan,"call",u=>u()]),c=f([o,"optionalAccess",u=>u.startChild,"call",u=>u({description:"execute",op:"graphql.execute"})]);f([s,"optionalAccess",u=>u.setSpan,"call",u=>u(c)]);const _=a.call(this,...r);return z(_)?_.then(u=>(f([c,"optionalAccess",d=>d.finish,"call",d=>d()]),f([s,"optionalAccess",d=>d.setSpan,"call",d=>d(o)]),u)):(f([c,"optionalAccess",u=>u.finish,"call",u=>u()]),f([s,"optionalAccess",u=>u.setSpan,"call",u=>u(o)]),_)}})}}F.__initStatic();class j{constructor(){j.prototype.__init.call(this)}static __initStatic(){this.id="Apollo"}__init(){this.name=j.id}setupOnce(e,n){const i=I("apollo-server-core");if(!i){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.error("Apollo Integration was unable to require apollo-server-core package.");return}if(D(n)){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log("Apollo Integration is skipped because of instrumenter configuration.");return}Y(i.ApolloServerBase.prototype,"constructSchema",function(a){return function(){if(!this.config.resolvers)return(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&(this.config.schema?l.warn("Apollo integration is not able to trace `ApolloServer` instances constructed via `schema` property."):this.config.modules&&l.warn("Apollo integration is not able to trace `ApolloServer` instances constructed via `modules` property."),l.error("Skipping tracing as no resolvers found on the `ApolloServer` instance.")),a.call(this);const r=Me(this.config.resolvers);return this.config.resolvers=r.map(s=>(Object.keys(s).forEach(o=>{Object.keys(s[o]).forEach(c=>{typeof s[o][c]=="function"&&mt(s,o,c,n)})}),s)),a.call(this)}})}}j.__initStatic();function mt(t,e,n,i){Y(t[e],n,function(a){return function(...r){const s=i().getScope(),o=f([s,"optionalAccess",u=>u.getSpan,"call",u=>u()]),c=f([o,"optionalAccess",u=>u.startChild,"call",u=>u({description:`${e}.${n}`,op:"graphql.resolve"})]),_=a.call(this,...r);return z(_)?_.then(u=>(f([c,"optionalAccess",d=>d.finish,"call",d=>d()]),u)):(f([c,"optionalAccess",u=>u.finish,"call",u=>u()]),_)}})}const m=$e;function gt(){m&&m.document?m.document.addEventListener("visibilitychange",()=>{const t=q();if(m.document.hidden&&t){const e="cancelled";(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log(`[Tracing] Transaction: ${e} -> since tab moved to the background, op: ${t.op}`),t.status||t.setStatus(e),t.setTag("visibilitychange","document.hidden"),t.finish()}}):(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.warn("[Tracing] Could not set up background tab detection due to lack of global document")}const re=(t,e,n)=>{let i,a;return r=>{e.value>=0&&(r||n)&&(a=e.value-(i||0),(a||i===void 0)&&(i=e.value,e.delta=a,t(e)))}},Tt=()=>`v3-${Date.now()}-${Math.floor(Math.random()*(9e12-1))+1e12}`,Et=()=>{const t=m.performance.timing,e=m.performance.navigation.type,n={entryType:"navigation",startTime:0,type:e==2?"back_forward":e===1?"reload":"navigate"};for(const i in t)i!=="navigationStart"&&i!=="toJSON"&&(n[i]=Math.max(t[i]-t.navigationStart,0));return n},Ae=()=>m.__WEB_VITALS_POLYFILL__?m.performance&&(performance.getEntriesByType&&performance.getEntriesByType("navigation")[0]||Et()):m.performance&&performance.getEntriesByType&&performance.getEntriesByType("navigation")[0],Ge=()=>{const t=Ae();return t&&t.activationStart||0},oe=(t,e)=>{const n=Ae();let i="navigate";return n&&(m.document.prerendering||Ge()>0?i="prerender":i=n.type.replace(/_/g,"-")),{name:t,value:typeof e>"u"?-1:e,rating:"good",delta:0,entries:[],id:Tt(),navigationType:i}},Z=(t,e,n)=>{try{if(PerformanceObserver.supportedEntryTypes.includes(t)){const i=new PerformanceObserver(a=>{e(a.getEntries())});return i.observe(Object.assign({type:t,buffered:!0},n||{})),i}}catch{}},ee=(t,e)=>{const n=i=>{(i.type==="pagehide"||m.document.visibilityState==="hidden")&&(t(i),e&&(removeEventListener("visibilitychange",n,!0),removeEventListener("pagehide",n,!0)))};addEventListener("visibilitychange",n,!0),addEventListener("pagehide",n,!0)},St=(t,e={})=>{const n=oe("CLS",0);let i,a=0,r=[];const s=c=>{c.forEach(_=>{if(!_.hadRecentInput){const u=r[0],d=r[r.length-1];a&&r.length!==0&&_.startTime-d.startTime<1e3&&_.startTime-u.startTime<5e3?(a+=_.value,r.push(_)):(a=_.value,r=[_]),a>n.value&&(n.value=a,n.entries=r,i&&i())}})},o=Z("layout-shift",s);o&&(i=re(t,n,e.reportAllChanges),ee(()=>{s(o.takeRecords()),i(!0)}))};let J=-1;const yt=()=>m.document.visibilityState==="hidden"&&!m.document.prerendering?0:1/0,Rt=()=>{ee(({timeStamp:t})=>{J=t},!0)},ce=()=>(J<0&&(J=yt(),Rt()),{get firstHiddenTime(){return J}}),Nt=(t,e={})=>{const n=ce(),i=oe("FID");let a;const r=c=>{c.startTime<n.firstHiddenTime&&(i.value=c.processingStart-c.startTime,i.entries.push(c),a(!0))},s=c=>{c.forEach(r)},o=Z("first-input",s);a=re(t,i,e.reportAllChanges),o&&ee(()=>{s(o.takeRecords()),o.disconnect()},!0)},ge={},bt=(t,e={})=>{const n=ce(),i=oe("LCP");let a;const r=o=>{const c=o[o.length-1];if(c){const _=Math.max(c.startTime-Ge(),0);_<n.firstHiddenTime&&(i.value=_,i.entries=[c],a())}},s=Z("largest-contentful-paint",r);if(s){a=re(t,i,e.reportAllChanges);const o=()=>{ge[i.id]||(r(s.takeRecords()),s.disconnect(),ge[i.id]=!0,a(!0))};["keydown","click"].forEach(c=>{addEventListener(c,o,{once:!0,capture:!0})}),ee(o,!0)}};function te(t){return typeof t=="number"&&isFinite(t)}function v(t,{startTimestamp:e,...n}){return e&&t.startTimestamp>e&&(t.startTimestamp=e),t.startChild({startTimestamp:e,...n})}function ve(){return m&&m.addEventListener&&m.performance}let Te=0,T={},y,k;function Dt(t=!1){const e=ve();e&&C&&(e.mark&&m.performance.mark("sentry-tracing-init"),Ut(),At(t),Gt())}function Bt(){Z("longtask",e=>{for(const n of e){const i=q();if(!i)return;const a=E(C+n.startTime),r=E(n.duration);i.startChild({description:"Main UI thread blocked",op:"ui.long-task",startTimestamp:a,endTimestamp:a+r})}})}function Ut(){St(t=>{const e=t.entries.pop();!e||((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log("[Measurements] Adding CLS"),T.cls={value:t.value,unit:""},k=e)})}function At(t){bt(e=>{const n=e.entries.pop();!n||((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log("[Measurements] Adding LCP"),T.lcp={value:e.value,unit:"millisecond"},y=n)},{reportAllChanges:t})}function Gt(){Nt(t=>{const e=t.entries.pop();if(!e)return;const n=E(C),i=E(e.startTime);(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log("[Measurements] Adding FID"),T.fid={value:t.value,unit:"millisecond"},T["mark.fid"]={value:n+i,unit:"second"}})}function vt(t){const e=ve();if(!e||!m.performance.getEntries||!C)return;(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log("[Tracing] Adding & adjusting spans using Performance API");const n=E(C),i=e.getEntries();let a,r;if(i.slice(Te).forEach(s=>{const o=E(s.startTime),c=E(s.duration);if(!(t.op==="navigation"&&n+o<t.startTimestamp))switch(s.entryType){case"navigation":{Yt(t,s,n),a=n+E(s.responseStart),r=n+E(s.requestStart);break}case"mark":case"paint":case"measure":{It(t,s,o,c,n);const _=ce(),u=s.startTime<_.firstHiddenTime;s.name==="first-paint"&&u&&((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log("[Measurements] Adding FP"),T.fp={value:s.startTime,unit:"millisecond"}),s.name==="first-contentful-paint"&&u&&((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log("[Measurements] Adding FCP"),T.fcp={value:s.startTime,unit:"millisecond"});break}case"resource":{const _=s.name.replace(m.location.origin,"");kt(t,s,_,o,c,n);break}}}),Te=Math.max(i.length-1,0),xt(t),t.op==="pageload"){typeof a=="number"&&((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log("[Measurements] Adding TTFB"),T.ttfb={value:(a-t.startTimestamp)*1e3,unit:"millisecond"},typeof r=="number"&&r<=a&&(T["ttfb.requestTime"]={value:(a-r)*1e3,unit:"millisecond"})),["fcp","fp","lcp"].forEach(o=>{if(!T[o]||n>=t.startTimestamp)return;const c=T[o].value,_=n+E(c),u=Math.abs((_-t.startTimestamp)*1e3),d=u-c;(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log(`[Measurements] Normalized ${o} from ${c} to ${u} (${d})`),T[o].value=u});const s=T["mark.fid"];s&&T.fid&&(v(t,{description:"first input delay",endTimestamp:s.value+E(T.fid.value),op:"ui.action",startTimestamp:s.value}),delete T["mark.fid"]),"fcp"in T||delete T.cls,Object.keys(T).forEach(o=>{t.setMeasurement(o,T[o].value,T[o].unit)}),wt(t)}y=void 0,k=void 0,T={}}function It(t,e,n,i,a){const r=a+n,s=r+i;return v(t,{description:e.name,endTimestamp:s,op:e.entryType,startTimestamp:r}),r}function Yt(t,e,n){["unloadEvent","redirect","domContentLoadedEvent","loadEvent","connect"].forEach(i=>{V(t,e,i,n)}),V(t,e,"secureConnection",n,"TLS/SSL","connectEnd"),V(t,e,"fetch",n,"cache","domainLookupStart"),V(t,e,"domainLookup",n,"DNS"),Ot(t,e,n)}function V(t,e,n,i,a,r){const s=r?e[r]:e[`${n}End`],o=e[`${n}Start`];!o||!s||v(t,{op:"browser",description:b(a,()=>n),startTimestamp:i+E(o),endTimestamp:i+E(s)})}function Ot(t,e,n){v(t,{op:"browser",description:"request",startTimestamp:n+E(e.requestStart),endTimestamp:n+E(e.responseEnd)}),v(t,{op:"browser",description:"response",startTimestamp:n+E(e.responseStart),endTimestamp:n+E(e.responseEnd)})}function kt(t,e,n,i,a,r){if(e.initiatorType==="xmlhttprequest"||e.initiatorType==="fetch")return;const s={};"transferSize"in e&&(s["Transfer Size"]=e.transferSize),"encodedBodySize"in e&&(s["Encoded Body Size"]=e.encodedBodySize),"decodedBodySize"in e&&(s["Decoded Body Size"]=e.decodedBodySize);const o=r+i,c=o+a;v(t,{description:n,endTimestamp:c,op:e.initiatorType?`resource.${e.initiatorType}`:"resource.other",startTimestamp:o,data:s})}function xt(t){const e=m.navigator;if(!e)return;const n=e.connection;n&&(n.effectiveType&&t.setTag("effectiveConnectionType",n.effectiveType),n.type&&t.setTag("connectionType",n.type),te(n.rtt)&&(T["connection.rtt"]={value:n.rtt,unit:"millisecond"})),te(e.deviceMemory)&&t.setTag("deviceMemory",`${e.deviceMemory} GB`),te(e.hardwareConcurrency)&&t.setTag("hardwareConcurrency",String(e.hardwareConcurrency))}function wt(t){y&&((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log("[Measurements] Adding LCP Data"),y.element&&t.setTag("lcp.element",ue(y.element)),y.id&&t.setTag("lcp.id",y.id),y.url&&t.setTag("lcp.url",y.url.trim().slice(0,200)),t.setTag("lcp.size",y.size)),k&&k.sources&&((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log("[Measurements] Adding CLS Data"),k.sources.forEach((e,n)=>t.setTag(`cls.source.${n+1}`,ue(e.node))))}const ie=["localhost",/^\//],se={traceFetch:!0,traceXHR:!0,tracingOrigins:ie,tracePropagationTargets:ie};function Ct(t){const{traceFetch:e,traceXHR:n,tracePropagationTargets:i,tracingOrigins:a,shouldCreateSpanForRequest:r}={traceFetch:se.traceFetch,traceXHR:se.traceXHR,...t},s=typeof r=="function"?r:_=>!0,o=_=>Pt(_,i||a),c={};e&&x("fetch",_=>{Mt(_,s,o,c)}),n&&x("xhr",_=>{Lt(_,s,o,c)})}function Pt(t,e){return Le(t,e||ie)}function Mt(t,e,n,i){if(!ae()||!(t.fetchData&&e(t.fetchData.url)))return;if(t.endTimestamp){const r=t.fetchData.__span;if(!r)return;const s=i[r];s&&(t.response?s.setHttpStatus(t.response.status):t.error&&s.setStatus("internal_error"),s.finish(),delete i[r]);return}const a=q();if(a){const r=a.startChild({data:{...t.fetchData,type:"fetch"},description:`${t.fetchData.method} ${t.fetchData.url}`,op:"http.client"});t.fetchData.__span=r.spanId,i[r.spanId]=r;const s=t.args[0];t.args[1]=t.args[1]||{};const o=t.args[1];n(t.fetchData.url)&&(o.headers=$t(s,a.getDynamicSamplingContext(),r,o),a.metadata.propagations+=1)}}function $t(t,e,n,i){const a=Ne(e),r=n.toTraceparent(),s=typeof Request<"u"&&le(t,Request)?t.headers:i.headers;if(s)if(typeof Headers<"u"&&le(s,Headers)){const o=new Headers(s);return o.append("sentry-trace",r),a&&o.append(ne,a),o}else if(Array.isArray(s)){const o=[...s,["sentry-trace",r]];return a&&o.push([ne,a]),o}else{const o="baggage"in s?s.baggage:void 0,c=[];return Array.isArray(o)?c.push(...o):o&&c.push(o),a&&c.push(a),{...s,"sentry-trace":r,baggage:c.length>0?c.join(","):void 0}}else return{"sentry-trace":r,baggage:a}}function Lt(t,e,n,i){if(!ae()||t.xhr&&t.xhr.__sentry_own_request__||!(t.xhr&&t.xhr.__sentry_xhr__&&e(t.xhr.__sentry_xhr__.url)))return;const a=t.xhr.__sentry_xhr__;if(t.endTimestamp){const s=t.xhr.__sentry_xhr_span_id__;if(!s)return;const o=i[s];o&&(o.setHttpStatus(a.status_code),o.finish(),delete i[s]);return}const r=q();if(r){const s=r.startChild({data:{...a.data,type:"xhr",method:a.method,url:a.url},description:`${a.method} ${a.url}`,op:"http.client"});if(t.xhr.__sentry_xhr_span_id__=s.spanId,i[t.xhr.__sentry_xhr_span_id__]=s,t.xhr.setRequestHeader&&n(t.xhr.__sentry_xhr__.url))try{t.xhr.setRequestHeader("sentry-trace",s.toTraceparent());const o=r.getDynamicSamplingContext(),c=Ne(o);c&&t.xhr.setRequestHeader(ne,c),r.metadata.propagations+=1}catch{}}}function Ht(t,e=!0,n=!0){if(!m||!m.location){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.warn("Could not initialize routing instrumentation due to invalid location");return}let i=m.location.href,a;e&&(a=t({name:m.location.pathname,op:"pageload",metadata:{source:"url"}})),n&&x("history",({to:r,from:s})=>{if(s===void 0&&i&&i.indexOf(r)!==-1){i=void 0;return}s!==r&&(i=void 0,a&&((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log(`[Tracing] Finishing current transaction with op: ${a.op}`),a.finish()),a=t({name:m.location.pathname,op:"navigation",metadata:{source:"url"}}))})}const Ft="BrowserTracing",jt={idleTimeout:be,finalTimeout:De,heartbeatInterval:Be,markBackgroundTransactions:!0,routingInstrumentation:Ht,startTransactionOnLocationChange:!0,startTransactionOnPageLoad:!0,_experiments:{enableLongTask:!0},...se};class _e{__init(){this.name=Ft}constructor(e){_e.prototype.__init.call(this),this.options={...jt,...e},e&&!e.tracePropagationTargets&&e.tracingOrigins&&(this.options.tracePropagationTargets=e.tracingOrigins);const{_metricOptions:n}=this.options;Dt(n&&n._reportAllChanges),f([this,"access",i=>i.options,"access",i=>i._experiments,"optionalAccess",i=>i.enableLongTask])&&Bt()}setupOnce(e,n){this._getCurrentHub=n;const{routingInstrumentation:i,startTransactionOnLocationChange:a,startTransactionOnPageLoad:r,markBackgroundTransactions:s,traceFetch:o,traceXHR:c,tracePropagationTargets:_,shouldCreateSpanForRequest:u}=this.options;i(d=>this._createRouteTransaction(d),r,a),s&&gt(),Ct({traceFetch:o,traceXHR:c,tracePropagationTargets:_,shouldCreateSpanForRequest:u})}_createRouteTransaction(e){if(!this._getCurrentHub){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.warn(`[Tracing] Did not create ${e.op} transaction because _getCurrentHub is invalid.`);return}const{beforeNavigate:n,idleTimeout:i,finalTimeout:a,heartbeatInterval:r}=this.options,s=e.op==="pageload",o=s?Ee("sentry-trace"):null,c=s?Ee("baggage"):null,_=o?ze(o):void 0,u=c?Ve(c):void 0,d={...e,..._,metadata:{...e.metadata,dynamicSamplingContext:_&&!u?{}:u},trimEnd:!0},h=typeof n=="function"?n(d):d,p=h===void 0?{...d,sampled:!1}:h;p.metadata=p.name!==d.name?{...p.metadata,source:"custom"}:p.metadata,p.sampled===!1&&(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log(`[Tracing] Will not send ${p.op} transaction because of beforeNavigate.`),(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log(`[Tracing] Starting ${p.op} transaction on scope`);const g=this._getCurrentHub(),{location:S}=m,N=nt(g,p,i,a,!0,{location:S},r);return N.registerBeforeFinishCallback(B=>{vt(B),B.setTag("sentry_reportAllChanges",Boolean(this.options._metricOptions&&this.options._metricOptions._reportAllChanges))}),N}}function Ee(t){const e=He(`meta[name=${t}]`);return e?e.getAttribute("content"):null}const Wt=Object.freeze(Object.defineProperty({__proto__:null,Express:P,Postgres:M,Mysql:$,Mongo:L,Prisma:H,GraphQL:F,Apollo:j,BrowserTracing:_e},Symbol.toStringTag,{value:"Module"}));var Se;(function(t){const e="ok";t.Ok=e;const n="deadline_exceeded";t.DeadlineExceeded=n;const i="unauthenticated";t.Unauthenticated=i;const a="permission_denied";t.PermissionDenied=a;const r="not_found";t.NotFound=r;const s="resource_exhausted";t.ResourceExhausted=s;const o="invalid_argument";t.InvalidArgument=o;const c="unimplemented";t.Unimplemented=c;const _="unavailable";t.Unavailable=_;const u="internal_error";t.InternalError=u;const d="unknown_error";t.UnknownError=d;const h="cancelled";t.Cancelled=h;const p="already_exists";t.AlreadyExists=p;const g="failed_precondition";t.FailedPrecondition=g;const S="aborted";t.Aborted=S;const N="out_of_range";t.OutOfRange=N;const B="data_loss";t.DataLoss=B})(Se||(Se={}));(typeof __SENTRY_TRACING__>"u"||__SENTRY_TRACING__)&&at();export{Ft as BROWSER_TRACING_INTEGRATION_ID,_e as BrowserTracing,A as IdleTransaction,Wt as Integrations,R as Span,Se as SpanStatus,je as TRACEPARENT_REGEXP,G as Transaction,at as addExtensionMethods,se as defaultRequestInstrumentationOptions,ze as extractTraceparentData,q as getActiveTransaction,ae as hasTracingEnabled,Ct as instrumentOutgoingRequests,Ke as spanStatusfromHttpCode,nt as startIdleTransaction,Xt as stripUrlQueryAndFragment};
